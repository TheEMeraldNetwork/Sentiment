<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêÖ TIGRO System Flow Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
            color: #333;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 2.5em;
        }
        
        .header p {
            margin: 0;
            color: #666;
            font-size: 1.2em;
        }
        
        .diagram-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .legend {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .legend h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .category {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
        }
        
        .category h3 {
            margin: 0 0 15px 0;
            font-size: 1.1em;
        }
        
        .category ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .category li {
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .data-source { border-color: #e1f5fe; background: #e1f5fe; }
        .sentiment { border-color: #f3e5f5; background: #f3e5f5; }
        .financial { border-color: #e8f5e8; background: #e8f5e8; }
        .optimization { border-color: #fff3e0; background: #fff3e0; }
        .positioning { border-color: #fce4ec; background: #fce4ec; }
        .output { border-color: #f1f8e9; background: #f1f8e9; }
        .automation { border-color: #e3f2fd; background: #e3f2fd; }
        
        .stats {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }
        
        .stat-label {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 0.9em;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        #mermaid-diagram {
            min-height: 600px;
        }
        
        @media (max-width: 768px) {
            .category-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üêÖ TIGRO System Flow Diagram</h1>
        <p>Complete Portfolio Optimization Architecture - 26 Components</p>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="zoomIn()">üîç Zoom In</button>
        <button class="btn" onclick="zoomOut()">üîç Zoom Out</button>
        <button class="btn" onclick="resetZoom()">‚Üª Reset</button>
        <button class="btn" onclick="downloadSVG()">üíæ Download</button>
    </div>
    
    <div class="diagram-container">
        <div id="mermaid-diagram">
            <div class="mermaid">
flowchart TD
    %% DATA SOURCES
    A1["ID-A1: Master Stock Universe<br/>Input: master name ticker.csv<br/>Output: 150 stock symbols<br/>Calc: Symbol validation"]
    A2["ID-A2: Current Portfolio Data<br/>Input: actual-portfolio-master.csv<br/>Output: 14 positions with values<br/>Calc: European number parsing"]
    A3["ID-A3: Market Data Fetch<br/>Input: Stock symbols from yfinance<br/>Output: OHLCV + analyst targets<br/>Calc: Price history, volatility"]
    A4["ID-A4: Sentiment Data Collection<br/>Input: News articles via FinBERT<br/>Output: Sentiment scores -1 to +1<br/>Calc: FinBERT AI processing"]
    A5["ID-A5: Risk-Free Rate<br/>Input: Treasury rates from yfinance<br/>Output: Current RF rate<br/>Calc: Average Treasury rate"]

    %% SENTIMENT PROCESSING
    B1["ID-B1: Sentiment Analysis Engine<br/>Input: Raw news articles<br/>Output: database/sentiment/detailed/<br/>Calc: FinBERT scoring"]
    B2["ID-B2: Monthly Sentiment Trends<br/>Input: Historical sentiment data<br/>Output: Trend analysis<br/>Calc: Moving averages"]
    B3["ID-B3: Sentiment Summary<br/>Input: Daily sentiment scores<br/>Output: database/sentiment/summary/<br/>Calc: Stock aggregation"]

    %% FINANCIAL CALCULATIONS
    C1["ID-C1: Portfolio Return Calculation<br/>Input: Current vs cost values<br/>Output: 4.83% baseline return<br/>Calc: Return formula"]
    C2["ID-C2: Individual Stock Returns<br/>Input: Price history<br/>Output: Annualized returns<br/>Calc: 252-day annualization"]
    C3["ID-C3: Volatility Matrix<br/>Input: Daily returns<br/>Output: Covariance matrix<br/>Calc: Standard deviation"]
    C4["ID-C4: Sharpe Ratio Calculation<br/>Input: Returns, volatility, RF rate<br/>Output: Risk-adjusted returns<br/>Calc: Sharpe formula"]
    C5["ID-C5: Analyst Target Integration<br/>Input: Low target prices<br/>Output: Upside potential<br/>Calc: Price differential"]

    %% OPTIMIZATION ENGINE
    D1["ID-D1: Markowitz Optimizer<br/>Input: Returns, covariance, constraints<br/>Output: Optimal weights<br/>Calc: Quadratic programming"]
    D2["ID-D2: Sentiment Integration<br/>Input: Financial score + sentiment<br/>Output: Composite score<br/>Calc: 80% financial + 20% sentiment"]
    D3["ID-D3: Risk Constraints<br/>Input: Target 7% return, 20% vol<br/>Output: Feasible portfolio<br/>Calc: Constraint satisfaction"]
    D4["ID-D4: VaR Calculation<br/>Input: Portfolio weights, returns<br/>Output: 97% VaR<br/>Calc: Monte Carlo simulation"]

    %% POSITION SIZING
    E1["ID-E1: Position Sizing Engine<br/>Input: Optimal weights, $10K cash<br/>Output: Share quantities<br/>Calc: Dollar allocation"]
    E2["ID-E2: Stop Loss Calculator<br/>Input: Volatility, correlations<br/>Output: Dynamic stop levels<br/>Calc: Volatility-adjusted stops"]
    E3["ID-E3: Rebalancing Logic<br/>Input: Current vs target weights<br/>Output: Buy/sell/hold decisions<br/>Calc: Deviation thresholds"]

    %% REPORTING
    F1["ID-F1: Dashboard Generator<br/>Input: All analysis results<br/>Output: GitHub Pages dashboard<br/>Calc: HTML generation"]
    F2["ID-F2: Action Table Generator<br/>Input: Optimization results<br/>Output: portfolio_action_table.html<br/>Calc: Trade recommendations"]
    F3["ID-F3: Email Reporter<br/>Input: Sentiment summary<br/>Output: Email alerts<br/>Calc: Change detection"]

    %% AUTOMATION
    G1["ID-G1: Daily Automation<br/>Input: Scheduled trigger<br/>Output: Complete analysis cycle<br/>Calc: master_runner_short.py"]
    G2["ID-G2: GitHub Integration<br/>Input: Analysis results<br/>Output: Live dashboard<br/>Calc: Git push to Pages"]

    %% CONNECTIONS
    A1 --> A3
    A1 --> A4
    A2 --> C1
    A3 --> C2
    A3 --> C3
    A3 --> C5
    A4 --> B1
    A5 --> C4
    
    B1 --> B2
    B1 --> B3
    B2 --> D2
    
    C1 --> D1
    C2 --> D1
    C3 --> D1
    C4 --> D2
    C5 --> D2
    
    D1 --> D3
    D2 --> D3
    D3 --> D4
    D3 --> E1
    
    E1 --> E2
    E1 --> E3
    E2 --> F2
    E3 --> F2
    
    D4 --> F1
    F2 --> F1
    B3 --> F3
    F1 --> G2
    F3 --> G1
    G1 --> G2

    %% STYLING
    classDef dataSource fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef sentiment fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef financial fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef optimization fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef positioning fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef output fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef automation fill:#e3f2fd,stroke:#0d47a1,stroke-width:2px

    class A1,A2,A3,A4,A5 dataSource
    class B1,B2,B3 sentiment
    class C1,C2,C3,C4,C5 financial
    class D1,D2,D3,D4 optimization
    class E1,E2,E3 positioning
    class F1,F2,F3 output
    class G1,G2 automation
            </div>
        </div>
    </div>
    
    <div class="legend">
        <h2>üìã Component Categories</h2>
        <div class="category-grid">
            <div class="category data-source">
                <h3>üîµ Data Sources (A1-A5)</h3>
                <ul>
                    <li><strong>A1</strong>: Master stock universe validation</li>
                    <li><strong>A2</strong>: Current portfolio parsing</li>
                    <li><strong>A3</strong>: Market data fetching</li>
                    <li><strong>A4</strong>: Sentiment data collection</li>
                    <li><strong>A5</strong>: Risk-free rate calculation</li>
                </ul>
            </div>
            
            <div class="category sentiment">
                <h3>üü£ Sentiment Processing (B1-B3)</h3>
                <ul>
                    <li><strong>B1</strong>: FinBERT sentiment analysis engine</li>
                    <li><strong>B2</strong>: Monthly trend analysis</li>
                    <li><strong>B3</strong>: Daily sentiment aggregation</li>
                </ul>
            </div>
            
            <div class="category financial">
                <h3>üü¢ Financial Calculations (C1-C5)</h3>
                <ul>
                    <li><strong>C1</strong>: Portfolio return baseline (4.83%)</li>
                    <li><strong>C2</strong>: Individual stock returns</li>
                    <li><strong>C3</strong>: Volatility/covariance matrix</li>
                    <li><strong>C4</strong>: Sharpe ratio calculations</li>
                    <li><strong>C5</strong>: Analyst target integration</li>
                </ul>
            </div>
            
            <div class="category optimization">
                <h3>üü† Optimization Engine (D1-D4)</h3>
                <ul>
                    <li><strong>D1</strong>: Markowitz mean-variance optimization</li>
                    <li><strong>D2</strong>: Sentiment overlay (80/20 weighting)</li>
                    <li><strong>D3</strong>: Risk constraint satisfaction</li>
                    <li><strong>D4</strong>: Value at Risk (97% confidence)</li>
                </ul>
            </div>
            
            <div class="category positioning">
                <h3>üü° Position Sizing (E1-E3)</h3>
                <ul>
                    <li><strong>E1</strong>: Optimal weight to share conversion</li>
                    <li><strong>E2</strong>: Dynamic stop loss calculation</li>
                    <li><strong>E3</strong>: Rebalancing trade decisions</li>
                </ul>
            </div>
            
            <div class="category output">
                <h3>üü§ Reporting & Output (F1-F3)</h3>
                <ul>
                    <li><strong>F1</strong>: GitHub Pages dashboard generation</li>
                    <li><strong>F2</strong>: Trading action table creation</li>
                    <li><strong>F3</strong>: Email alert system</li>
                </ul>
            </div>
            
            <div class="category automation">
                <h3>üî∑ Automation (G1-G2)</h3>
                <ul>
                    <li><strong>G1</strong>: Daily 5:15 PM CET automation</li>
                    <li><strong>G2</strong>: Live dashboard deployment</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="stats">
        <h2>üìä System Statistics</h2>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">26</div>
                <div class="stat-label">Components</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">14</div>
                <div class="stat-label">Scripts</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">150</div>
                <div class="stat-label">Stocks Tracked</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">7%</div>
                <div class="stat-label">Target Return</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">20%</div>
                <div class="stat-label">Target Volatility</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">4.83%</div>
                <div class="stat-label">Current Return</div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'linear'
            }
        });
        
        let currentZoom = 1;
        
        function zoomIn() {
            currentZoom += 0.2;
            applyZoom();
        }
        
        function zoomOut() {
            currentZoom = Math.max(0.4, currentZoom - 0.2);
            applyZoom();
        }
        
        function resetZoom() {
            currentZoom = 1;
            applyZoom();
        }
        
        function applyZoom() {
            const diagram = document.getElementById('mermaid-diagram');
            diagram.style.transform = `scale(${currentZoom})`;
            diagram.style.transformOrigin = 'top left';
        }
        
        function downloadSVG() {
            const svg = document.querySelector('#mermaid-diagram svg');
            if (svg) {
                const svgData = new XMLSerializer().serializeToString(svg);
                const blob = new Blob([svgData], {type: 'image/svg+xml'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'tigro-system-flow.svg';
                a.click();
                URL.revokeObjectURL(url);
            }
        }
        
        // Add click handlers to nodes
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const nodes = document.querySelectorAll('.node');
                nodes.forEach(node => {
                    node.style.cursor = 'pointer';
                    node.addEventListener('click', function() {
                        const text = this.querySelector('span');
                        if (text) {
                            alert(`Component Details:\n${text.textContent}`);
                        }
                    });
                });
            }, 2000);
        });
    </script>
</body>
</html> 